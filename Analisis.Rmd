---
title: "Proyecto 1"
author: "Gerardo Pineda 22880, Daniel Rayo"
date: "2025-01-28"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r install librarys and load movies, echo=FALSE, warning=FALSE}
library(dplyr)
library(knitr)
library(ggplot2)
library(tidyr)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
movies <- read.csv("movies.csv")
```

# Analisis Exploratorio
## 1. Resumen del conjunto de datos
Haga una exploración rápida de sus datos, para eso haga un resumen de su conjunto
de datos.
```{r movies description, echo=FALSE}
summary(movies)
```
## 2. Tipo de cada variable
Diga el tipo de cada una de las variables (cualitativa ordinal o nominal, cuantitativa
continua, cuantitativa discreta).

```{r variables, echo=FALSE}
types_table <- data.frame(Variable = names(movies), Tipo = sapply(movies, class))
kable(types_table)
```

### 3. Analisis de las variables del dataset

#### Cuantitativas


#### Cualitativas


### 4. Preguntas sobre  los datos
  
**4.1 ¿Cuáles son las 10 películas que contaron con más presupuesto?**

Las peliculas que tuvieron un mayor presupuesto son

```{r mas presupuesto, echo=FALSE}
topTen <- movies[order(-movies$budget), c("id", "title", "budget")][1:10, ]
topTen$budget <- format(topTen$budget, big.mark = ",", scientific = FALSE)
kable(topTen)

```

**4.2. ¿Cuáles son las 10 películas que más ingresos tuvieron?**


**4.3 ¿Cuál es la película que más votos tuvo?**

```{r most votes, echo=FALSE}
mostVotes <- movies[order(-movies$voteCount), c("id", "title", "voteCount")]
mostVoteMovie <- mostVotes[1,]
```
La pelicula que mas tuvo votos fue **`r mostVoteMovie$title`** con una cantidad de **`r mostVoteMovie$voteCount`** votos

**4.4.  ¿Cuál es la peor película de acuerdo a los votos de todos los usuarios?**

**4.5 ¿Cuántas películas se hicieron en cada año? ¿En qué año se hicieron más películas?**

```{r most movies in a year, echo=FALSE}
movies$releaseDate <- as.Date(movies$releaseDate)
movies$Anio <- format(movies$releaseDate, "%Y")
moviesPerYear <- aggregate(movies[, c("id")], by=list(movies$Anio), FUN=length)
colnames(moviesPerYear) <- c("Anio", "TotalPeliculas")

max_year_release <- moviesPerYear[moviesPerYear$TotalPeliculas,]

max_total <- subset(moviesPerYear, TotalPeliculas == max(TotalPeliculas))

ggplot(moviesPerYear, aes(x = Anio, y = TotalPeliculas, fill = TotalPeliculas)) +
  geom_bar(stat = "identity", color = "black") +
  scale_fill_gradient(low = "skyblue", high = "darkblue") +
  theme_minimal() +
  labs(title = "Grafica 1: Peliculas por Año", x = "Año", y = "Cantidad") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size=5))
```

En el año **`r max_total$Año`** se publicaron un total de **`r max_total$TotalPelículas`** peliculas

**4.6 Cuál es el género principal de las 20 películas más recientes? ¿Cuál es el género principal que predomina en el conjunto de datos? Represéntelo usando un gráfico. ¿A qué género principal pertenecen las películas más largas?**


**4.7 ¿Las películas de qué genero principal obtuvieron mayores ganancias?**

```{r gains, echo=FALSE}
# Obtenemos primero los ingresos de las peliculas
subsetRevenue <- subset(movies, select = c("genres", "revenue"))

mostProfitGenre <- aggregate(subsetRevenue[, c("revenue")], by=list(subsetRevenue$genres), FUN=sum)

colnames(mostProfitGenre) <- c("Generos", "Ingresos")

# Lugo se obtienen los presupuestos de las peliculas

subsetBugets <- subset(movies, select = c("genres", "budget"))

mostBugetsGenre <- aggregate(subsetBugets[, c("budget")], by=list(subsetBugets$genres), FUN=sum)

colnames(mostBugetsGenre) <- c("Generos", "Presupuesto")

# Calculamos la ganancia

profitGenre <- merge(mostProfitGenre, mostBugetsGenre, by="Generos")

profitGenre$Ganancia <- profitGenre$Ingresos - profitGenre$Presupuesto

profitGenre <- profitGenre[order(-profitGenre$Ganancia), ]

profitGenre$Ganancia <- format(profitGenre$Ganancia, big.mark = ",", scientific = FALSE)
# profitGenre

```


Las peliculas del genero **`r profitGenre[1,]$Generos`** fuerón las que presentarón una mayor ganancia teniendo en total una ganacia de **`r profitGenre[1,]$Ganancia`** $

**4.8 ¿La cantidad de actores influye en los ingresos de las películas?¿se han hecho películas con más actores en los últimos años?**

**4.9 ¿Es posible que la cantidad de hombres y mujeres en el reparto influya en la popularidad y los ingresos de las películas?**

```{r men and women, echo=FALSE}

popRevMovies <- aggregate(movies[, c("popularity", "revenue")], by=list(MasHombres = movies[, "castMenAmount"] > movies[,"castWomenAmount"]), FUN=mean) 

kable(popRevMovies)

```

Como se puede evidenciar en la tabla las peliculas que tienen una mayor cantidad de hombres son mas populares y tienen una mayor ganancia

**4.10 ¿Quiénes son los directores que hicieron las 20 películas mejor calificadas?**

**4.11 ¿Cómo se correlacionan los presupuestos con los ingresos? ¿Los altos presupuestos significan altos ingresos?**


```{r budget range, echo=FALSE, warning=FALSE}

movies_grouped <- movies %>%
  filter(!is.na(budget) & budget > 0) %>%  
  mutate(budget_bin = cut(budget, breaks = seq(0, max(budget, na.rm = TRUE), by = 50000000), include.lowest = TRUE)) %>%
  group_by(budget_bin) %>%
  summarise(avg_revenue = mean(revenue, na.rm = TRUE)) %>%
  drop_na()  

ggplot(movies_grouped, aes(x = budget_bin, y = avg_revenue, group = 1)) +
  geom_line(color = "red", linewidth = 1) +
  theme_minimal() +
  labs(title = "Grafica 1: Ingresos Promedio por Rango de Presupuesto",
       x = "Rango de Presupuesto",
       y = "Ingreso Promedio") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


```{r budget and revenue lines, echo=FALSE}
movies_filtered <- movies %>%
  filter(!is.na(budget) & !is.na(revenue) & budget > 0 & revenue > 0) %>%
  arrange(budget)

movies_long <- movies_filtered %>%
  select(title, budget, revenue) %>%
  pivot_longer(cols = c(budget, revenue),
               names_to = "Tipo",
               values_to = "Valor")

ggplot(movies_long, aes(x = reorder(title, Valor), y = Valor, color = Tipo, group = Tipo)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  theme_minimal() +
  labs(title = "Grafica 2: Comparacion de Presupuesto e Ingresos por Pelicula",
       x = "Pelicula",
       y = "Valor en USD",
       color = "Tipo") +
  theme(axis.text.x = element_blank()) +
  theme(legend.position = "top")

```

Como se puede evidenciar apartir de la Grafica 1, cuando el rango de presupuesto es mas elevado este suele precentar una mayor cantidad de ingres. Al igual como se ve en la Grafica 2, que en la mayoria de peliculas, se puede evidenciar que tener un presupuesto elevado significa tener mas ingresos. 


**4.12 Se asocian ciertos meses de lanzamiento con mejores ingresos?**

**4.13 ¿En qué meses se han visto los lanzamientos con mejores ingresos? ¿cuantas películas, en promedio, se han lanzado por mes?**

```{r month releases, echo=FALSE}
movies$Mes <- format(as.Date(movies$releaseDate), "%m")
subsetMonthRevenue <- subset(movies, select = c("Mes", "revenue"))

mostMonthRevenue <- aggregate(subsetMonthRevenue[, c("revenue")], by=list(subsetMonthRevenue$Mes), FUN=mean)

colnames(mostMonthRevenue) <- c("Mes", "Ingresos Promedio")

mostMonthRevenue <- mostMonthRevenue[order(-mostMonthRevenue$`Ingresos Promedio`), ][1,]
mostMonthRevenue$"Ingresos Promedio" <- format(mostMonthRevenue$"Ingresos Promedio", big.mark = ",", scientific = FALSE)


```

En el mes en el que se presentan mejores ingresos es `r mostMonthRevenue$Mes` con un total de ingresos promedio de `r mostMonthRevenue$"Ingresos Promedio"` $

**4.14 ¿Cómo se correlacionan las calificaciones con el éxito comercial?**

**4.15 ¿Qué estrategias de marketing, como videos promocionales o páginas oficiales, generan mejores resultados?**

**4.16 ¿La popularidad del elenco está directamente correlacionada con el éxito de taquilla?**

### Preguntas Extras

**1. <inserte pregunta>**

**2. <inserte pregunta>**

**3. <inserte pregunta>**

**4. <inserte pregunta>**

**5. <inserte pregunta>**

**6. <inserte pregunta>**


