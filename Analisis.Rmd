---
title: "Proyecto 1"
author: "Gerardo Pineda 22880, Daniel Rayo"
date: "2025-01-28"
output:
  html_document:
    df_print: paged
  pdf_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r install librarys and load movies, echo=FALSE}
library(knitr)
library(ggplot2)
library(dplyr)
movies <- read.csv("movies.csv")
```

# Analisis Exploratorio
## 1. Resumen del conjunto de datos
Haga una exploración rápida de sus datos, para eso haga un resumen de su conjunto
de datos.
```{r movies description, echo=FALSE}
summary(movies)
```
## 2. Tipo de cada variable
Diga el tipo de cada una de las variables (cualitativa ordinal o nominal, cuantitativa
continua, cuantitativa discreta).

```{r variables, echo=FALSE}
types_table <- data.frame(Variable = names(movies), Tipo = sapply(movies, class))
kable(types_table)
```

### 3. Analisis de las variables del dataset

#### Cuantitativas
Usando la prueba de Shapiro-will en las variables cuantitativas utilizando un 0.05 de confianza, podemos verificar que todas las variables fallan la prueba, teniendo valores que se pasan del limite de tolerania de 0.05.
```{r}
# Function to check normality with random sampling for large datasets
check_normality <- function(variable) {
  variable <- na.omit(variable)  # Remove NA values
  n <- length(variable)          # Count valid observations
  
  # If too few values, return a message
  if (n < 3) {
    return(c(Normalidad = "No se puede evaluar (muy pocos datos)", P_Value = NA))
  }
  
  # If more than 5000 values, take a random sample of 5000
  if (n > 5000) {
    variable <- sample(variable, 5000)
  }
  
  # Apply Shapiro-Wilk test
  test <- shapiro.test(variable)
  p_value <- test$p.value
  normal <- ifelse(p_value > 0.05, "Sí", "No")  # Determine normality
  
  return(c(esNormal = normal, P_Value = p_value))
}
cuantitative_variables <- movies[, c("popularity", "budget", "revenue", "runtime","voteCount", "genresAmount", "productionCoAmount", "productionCountriesAmount", "actorsAmount")]
cuantitative_variables$castWomenAmount <- suppressWarnings(as.numeric(movies$castWomenAmount))
cuantitative_variables$castMenAmount <- suppressWarnings(as.numeric(movies$castMenAmount))

# Apply function to each column and convert results to a data frame
results <- as.data.frame(t(sapply(cuantitative_variables, check_normality)))

# Print the table
print(results)
```

#### Cualitativas
Viendod los analisis de frecuencia se puede ver a simple vista que las peliculas de Drama son las mas cómunes, la mayoría fueron producidas por Paramount Studios. El director más frecuente es Steven Spielberg y el idioma prediminante es el inglés.
```{r}
# Function to clean strings (convert to valid UTF-8)
clean_strings <- function(x) {
  # Convert to UTF-8 and remove non-UTF-8 characters
  x <- iconv(x, to = "UTF-8", sub = "byte")  # Convert characters to UTF-8
  x <- gsub("[^[:print:]]", "", x)  # Remove non-printable characters
  return(x)
}

# Get only categorical variables (assuming they are factors or characters)
categorical_vars <- movies[, c("genres", "homePage", "productionCompany", 
                               "productionCompanyCountry", "productionCountry", 
                               "director", "originalTitle", "title", 
                               "originalLanguage", "releaseDate")]

# Clean the categorical variables
categorical_vars <- categorical_vars %>%
  mutate(across(everything(), clean_strings))

# Function to generate and print a frequency table for each categorical variable
print_frequency_tables <- function(data) {
  for (var in colnames(data)) {
    
    # Create frequency table
    freq_table <- table(data[[var]]) %>% as.data.frame()
    colnames(freq_table) <- c(var, "Frequency")
    
    # Order by Frequency in descending order
    freq_table <- freq_table %>% arrange(desc(Frequency))
    
    # Print the frequency table using knitr::kable() for plain rendering
    print(kable(head(freq_table), caption = paste("Frequency Table for", var)))
  }
}

# Call the function
print_frequency_tables(categorical_vars)

```

### 4. Preguntas sobre  los datos
  
**4.1 ¿Cuáles son las 10 películas que contaron con más presupuesto?**

Las peliculas que tuvieron un mayor presupuesto son

```{r mas presupuesto, echo=FALSE}
topTen <- movies[order(-movies$budget), c("id", "title", "budget")][1:10, ]
topTen
```

**4.2. ¿Cuáles son las 10 películas que más ingresos tuvieron?**


**4.3 ¿Cuál es la película que más votos tuvo?**

```{r most votes, echo=FALSE}
mostVotes <- movies[order(-movies$voteCount), c("id", "title", "voteCount")]
mostVoteMovie <- mostVotes[1,]
```
La pelicula que mas tuvo votos fue **`r mostVoteMovie$title`** con una cantidad de **`r mostVoteMovie$voteCount`** votos

**4.4.  ¿Cuál es la peor película de acuerdo a los votos de todos los usuarios?**

**4.5 ¿Cuántas películas se hicieron en cada año? ¿En qué año se hicieron más películas?**

```{r most movies in a year, echo=FALSE}
movies$releaseDate <- as.Date(movies$releaseDate)
movies$Año <- format(movies$releaseDate, "%Y")
moviesPerYear <- aggregate(movies[, c("id")], by=list(movies$Año), FUN=length)
colnames(moviesPerYear) <- c("Año", "TotalPelículas")

max_year_release <- moviesPerYear[moviesPerYear$TotalPelículas,]

max_total <- subset(moviesPerYear, TotalPelículas == max(TotalPelículas))

ggplot(moviesPerYear, aes(x = Año, y = TotalPelículas, fill = TotalPelículas)) +
  geom_bar(stat = "identity", color = "black") +
  scale_fill_gradient(low = "skyblue", high = "darkblue") +
  theme_minimal() +
  labs(title = "Películas por Año", x = "Año", y = "Cantidad") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

En el año `r max_total$Año` se publicaron un total de `r max_total$TotalPelículas` peliculas

**4.6 Cuál es el género principal de las 20 películas más recientes? ¿Cuál es el género principal que predomina en el conjunto de datos? Represéntelo usando un gráfico. ¿A qué género principal pertenecen las películas más largas?**


**4.7 ¿Las películas de qué genero principal obtuvieron mayores ganancias?**

**4.8 ¿La cantidad de actores influye en los ingresos de las películas?¿se han hecho películas con más actores en los últimos años?**

**4.9 ¿Es posible que la cantidad de hombres y mujeres en el reparto influya en la popularidad y los ingresos de las películas?**

**4.10 ¿Quiénes son los directores que hicieron las 20 películas mejor calificadas?**

**4.11 ¿Cómo se correlacionan los presupuestos con los ingresos? ¿Los altos presupuestos significan altos ingresos? Haga los gráficos que necesite, histograma, diagrama de dispersión**

**4.12 Se asocian ciertos meses de lanzamiento con mejores ingresos?**

**4.13 ¿En qué meses se han visto los lanzamientos con mejores ingresos? ¿cuantas películas, en promedio, se han lanzado por mes?**

**4.14 ¿Cómo se correlacionan las calificaciones con el éxito comercial?**

**4.15 ¿Qué estrategias de marketing, como videos promocionales o páginas oficiales, generan mejores resultados?**

**4.16 ¿La popularidad del elenco está directamente correlacionada con el éxito de taquilla?**

### Preguntas Extras

**1. <inserte pregunta>**

**2. <inserte pregunta>**

**3. <inserte pregunta>**

**4. <inserte pregunta>**

**5. <inserte pregunta>**

**6. <inserte pregunta>**


